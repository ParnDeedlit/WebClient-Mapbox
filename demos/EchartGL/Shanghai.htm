<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>大数据演示</title>
  <script include="jquery" src="../../libs/zondyclient/include-lib.js"></script>
  <script include="elasticsearch,echarts,geojson,shapefile" src="../../libs/zondyclient/include-mapboxgl.js"></script>
  <style>
    #mapid {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="mapid"></div>
  <script>
    //一定要去mapbox注册一个key,这个key会失效的
    mapboxgl.accessToken = 'pk.eyJ1IjoicGFybmRlZWRsaXQiLCJhIjoiY2o1MjBtYTRuMDhpaTMzbXhpdjd3YzhjdCJ9.sCoubaHF9-nhGTA-sgz0sA';
    var myChart = echarts.init(document.getElementById('mapid'), null, {
      devicePixelRatio: 1
    });
    var uploadedDataURL = "../../data/echart/shanghai/data.json";

    myChart.showLoading();

    $.getJSON(uploadedDataURL, function(linedata) {

      myChart.hideLoading();

      myChart.setOption({

        visualMap: {
          show: false,
          calculable: true,
          realtime: false,
          inRange: {
            color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']
          },
          outOfRange: {
            colorAlpha: 0
          },
          max: linedata[1]
        },
        mapbox: {
          center: [121.4693, 31.123070],
          zoom: 10,
          pitch: 50,
          bearing: -10,
          style: 'mapbox://styles/mapbox/light-v9',
          boxHeight: 50,
          // altitudeScale: 3e2,
          postEffect: {
            enable: true,
            SSAO: {
              enable: true,
              radius: 2,
              intensity: 1.5
            }
          },
          light: {
            main: {
              intensity: 1,
              shadow: true,
              shadowQuality: 'high'
            },
            ambient: {
              intensity: 0.
            },
            ambientCubemap: {
              texture: 'http://localhost:4000/mapgis/data/shanghai/data.hdr',
              exposure: 1,
              diffuseIntensity: 0.5
            }
          }
        },
        series: [{
          type: 'bar3D',
          shading: 'realistic',
          coordinateSystem: 'mapbox',
          barSize: 0.2,
          silent: true,
          data: linedata[0]
        }]
      });
    });
    window.addEventListener('keydown', function() {
      myChart.dispatchAction({
        type: 'lines3DToggleEffect',
        seriesIndex: 0
      });
    });
  </script>
</body>

</html>
